$(function(){window.colors={S1:"#c62828",S2:"#ffd600",S3:"#2e7d32",S4:"#1565c0",S5:"#6a1b9a"};window.pieChartBackupData={};window.chartList=[];$("select").material_select();$(".datepicker").pickadate({selectMonths:!0,selectYears:5,closeOnSelect:!1,container:void 0,today:"Aujourd'hui",clear:"Effacer",close:"Ok",labelMonthNext:"Mois suivant",labelMonthPrev:"Mois pr\u00e9cedant",labelMonthSelect:"Selectionner un mois",labelYearSelect:"Selectionner une ann\u00e9e",monthsFull:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "),
monthsShort:"Janv. F\u00e9vr. Mars Avr. Mai Juin Juil. Ao\u00fbt Sept. Oct. Nov. D\u00e9c.".split(" "),weekdaysFull:"Dimanche Lundi Mardi Mercredi Jeudi Vendredi Samedi".split(" "),weekdaysShort:"Di Lu Ma Me Je Ve Sa".split(" "),weekdaysLetter:"DLMMJVS".split("")});$.each($("#LineCharts canvas"),function(a,c){getData($(c).attr("id").replace("Zone",""),"ZoneChart")});getData("novalue","LineChartData");makePieChart();mapOpenHandler();returnClickHandler();selectChangeHandler();clearClickHandler();searchClickHandler();
$("#SiteID").trigger("change");$("#Search").trigger("click")});
function getData(a,c){$.getJSON("/dashboard/api",{value:a,field:c},function(b){if("ZoneChart"===c)b=makeLineChart($("#Zone"+a),b.result.ZoneName),window.chartList.push([a,b]);else if("LineChartData"===c)$.each(b.result,function(a,b){$.each(window.chartList,function(c,d){if(a===d[0]){var e=d[1][0];$.each(b,function(a,b){var c=[];$.each(b,function(a,b){c.push({t:new Date(a),y:b})});e.data.datasets.push({label:a,data:c,borderWidth:2,borderColor:window.colors[a],backgroundColor:"rgba(0, 0, 0, 0)",pointBackgroundColor:window.colors[a]})});
e.update()}})});else if("PieChartData"===c){var d={labels:[],datasets:[{data:[],backgroundColor:[]}]};window.pieChartDetail={};$.isEmptyObject(b.result)?(window.pieChart.data={labels:["Aucune donn\u00e9e"],datasets:[{data:[1],backgroundColor:["rgba(150, 150, 150, 1)"]}]},window.pieChart.options.tooltips.enabled=!1,$("#PieChart").off("click")):($.each(b.result,function(a,b){d.labels.push(b.Description);d.datasets[0].data.push(b.Total);d.datasets[0].backgroundColor.push(window.colors[a]);pieChartDetail[b.Description]=
b.Detail}),window.pieChartBackupData.labels=d.labels.slice(0,d.labels.length),window.pieChartBackupData.data=d.datasets[0].data.slice(0,d.datasets[0].data.length),window.pieChartBackupData.backgroundColor=d.datasets[0].backgroundColor.slice(0,d.datasets[0].backgroundColor.length),window.pieChart.data=d,window.pieChart.options.tooltips.enabled=!0,disableHandler(),enableHandler());window.pieChart.options.title.display=!1;window.pieChart.update();$("#Search").removeClass("disabled")}else{removeOptions(c);
for(var e=0,f=b.result.length;e<f;e++){var g=b.result[e][c+"Name"];if("Category"===c||"LocationType"===c)g=b.result[e].Description;$("#"+c+"ID").append($("<option></option>").attr("value",b.result[e][c+"ID"]).text(g))}$("select").material_select()}})}
function makeLineChart(a,c){var b=[],d=a[0].getContext("2d");d=new Chart(d,{type:"line",data:{labels:[],datasets:[]},options:{title:{display:!1,position:"top",text:c},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Nombre d'anomalies"},ticks:{beginAtZero:!0,stepSize:1},drawBorder:!0}],xAxes:[{type:"time",position:"bottom",time:{displayFormats:{day:"DD/MM"},minUnit:"day"},ticks:{source:"data"},distribution:"series"}]},legend:{display:!0,position:"top"},elements:{line:{tension:0}},maintainAspectRatio:!1,
responsiveAnimationDuration:0,hover:{mode:"nearest"}}});b.push(d);return b}function makePieChart(){var a=$("#PieChart")[0].getContext("2d");a=new Chart(a,{type:"pie",data:{labels:[],datasets:[{data:[],backgroundColor:[]}]},options:{title:{display:!1,position:"top",text:""},legend:{position:"top"},animation:{animateRotate:!1},maintainAspectRatio:!1}});window.pieChart=a}
function PieClickHandler(a){if(a=window.pieChart.getElementAtEvent(a)[0]){a=window.pieChart.data.labels[a._index];var c=[],b=[];$.each(pieChartDetail[a],function(a,e){c.push(a);b.push(e)});window.pieChart.data.labels=c.slice(0,c.length);window.pieChart.data.datasets[0].data=b.slice(0,b.length);window.pieChart.options.title.display=!0;window.pieChart.options.title.text=a;window.pieChart.update();disableHandler();$("#Return").removeClass("hide").addClass("show")}}
function enableHandler(){$("#PieChart").on("click",function(a){PieClickHandler(a)})}function disableHandler(){$("#PieChart").off("click")}function removeOptions(a){$("#"+a+"ID")[0].selectedIndex=0;$("#"+a+"ID").children("option:not(:first)").remove()}
function returnClickHandler(){$("#Return").on("click",function(){$(this).removeClass("show").addClass("hide");window.pieChart.data.datasets[0].data=window.pieChartBackupData.data;window.pieChart.data.datasets[0].backgroundColor=window.pieChartBackupData.backgroundColor;window.pieChart.data.labels=window.pieChartBackupData.labels;window.pieChart.options.title.display=!1;window.pieChart.update();disableHandler();enableHandler()})}
function searchClickHandler(){$("#Search").on("click",function(){var a={dateFrom:$("#dateFrom").val(),dateTo:$("#dateTo").val(),SiteID:$("#SiteID").val(),ZoneID:$("#ZoneID").val(),UnitID:$("#UnitID").val(),LocationTypeID:$("#LocationTypeID").val(),LocationID:$("#LocationID").val()};$(this).addClass("disabled");window.pieDataQuery=JSON.stringify(a);getData(window.pieDataQuery,"PieChartData")})}
function clearClickHandler(){$("#Clear").on("click",function(){var a=[$("#dateFrom"),$("#dateTo"),$("#SiteID")];$.each(a,function(a,b){b.val("")});$.each(["Zone","Unit","LocationType","Location"],function(a,b){removeOptions(b)});$("select").material_select()})}
function selectChangeHandler(){var a=["Zone","Unit","LocationType","Location"],c=a.slice(1,a.length),b=a.slice(2,a.length),d=a.slice(3,a.length);a=[[$("#SiteID"),a],[$("#ZoneID"),c],[$("#UnitID"),b],[$("#LocationTypeID"),d]];c={};b=0;for(d=a.length;b<d;c={inputArray:c.inputArray},b++){var e=a[b][0],f=a[b][1];c.inputArray=f.slice(0,f.length);e.on("change",function(a){return function(){for(var b=0,c=a.inputArray.length;b<c;b++)removeOptions(a.inputArray[b]);b=$(this).val();"Location"==a.inputArray[0]&&
(b=$("#UnitID"),b={LocationTypeID:$(this).val(),UnitID:b.val()},b=JSON.stringify(b));getData(b,a.inputArray[0])}}(c))}}
function makeParetoChart(a){var c="";$.each(a,function(b,a){c=a.getContext("2d")});new Chart(c,{type:"bar",data:{labels:["S1","S2","S3","S4","S5"],datasets:[{label:"Bar Dataset",data:[66,50,40,24,20],borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.2)",yAxisID:"original"},{label:"Line Dataset",data:[33,58,78,90,100],type:"line",fill:!1,borderColor:"rgb(54, 162, 235)",yAxisID:"test"}]},options:{scales:{yAxes:[{id:"original",type:"linear",ticks:{beginAtZero:!0}},{id:"test",type:"linear",
ticks:{beginAtZero:!0},position:"right"}]}}})}
function mapOpenHandler(){function a(a,c){a.eachLayer(function(a){var b={weight:.25,color:"black",fillColor:"grey",fillOpacity:.8};c==a.feature.properties.ZoneID&&(b={weight:.25,color:"black",fillColor:"red",fillOpacity:.8});a.setStyle(b)})}function c(a,c){null==window.MapData&&$.getJSON("/dashboard/api",{field:"Zone",value:"1"},function(b){for(var d=0,e=b.result.length;d<e;d++)a.properties.ZoneID==b.result[d].ZoneID&&c.bindTooltip(b.result[d].ZoneName)})}$(".activator").on("click",function(){var b=
$(this).attr("id").split("-")[1];null!=window["map"+b+"init"]&&window["map"+b+"init"].remove();window["map"+b+"init"]=null;var d=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,maxZoom:18,attribution:'Map data \u00a9 <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}),e=L.geoJSON({type:"FeatureCollection",name:"COPAG_Polygon",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{type:"Feature",properties:{id:1,Zone:"OUEST",ZoneID:4},
geometry:{type:"Polygon",coordinates:[[[-8.79134691000599,30.510241444922194],[-8.791251814754283,30.51001552140443],[-8.791551508880879,30.50992117956033],[-8.791571680600937,30.50989138738001],[-8.791649485806879,30.509866560556112],[-8.791707119292763,30.509993177291733],[-8.792231584014305,30.509831802991997],[-8.79235261433466,30.510052761580855],[-8.792450591260662,30.510025452119557],[-8.792565858232429,30.510301029059168],[-8.7926292550669,30.510462402580128],[-8.79265519013555,30.510462402580128],
[-8.792701296924255,30.510589018539832],[-8.79282232724461,30.51055426123398],[-8.792701296924255,30.510301029059168],[-8.792525514792311,30.509881456651215],[-8.792493816375075,30.5097995280999],[-8.792577384929606,30.509769735882315],[-8.792565858232429,30.509710151419743],[-8.792675361855608,30.509677876487267],[-8.792660953484138,30.509605878522397],[-8.792790628827374,30.509566155484467],[-8.792816563896023,30.5095884996953],[-8.792957765936439,30.509551259341045],[-8.792989464353674,30.5095884996953],
[-8.79317965485709,30.509543811268493],[-8.793502402378037,30.510166964699618],[-8.793597497629746,30.51038792252682],[-8.79367530283569,30.510566674558927],[-8.793629196046982,30.510626258496597],[-8.792606201672546,30.510797562114014],[-8.791975115002122,30.510919212325707],[-8.791371352232748,30.51102678875271],[-8.791316480971597,30.510900396869566],[-8.791261429512572,30.510778296537854],[-8.79118449920986,30.510593775656474],[-8.791089367248922,30.51035518400726],[-8.79107627123231,30.510315856563377],
[-8.79134691000599,30.510241444922194]]]}},{type:"Feature",properties:{id:2,Zone:"OUEST",ZoneID:4},geometry:{type:"Polygon",coordinates:[[[-8.792807918873141,30.50872451980387],[-8.793026926119499,30.509235957103545],[-8.792663835158432,30.509355126573347],[-8.792439064563485,30.508838724482693],[-8.792807918873141,30.50872451980387]]]}},{type:"Feature",properties:{id:3,Zone:"OUEST",ZoneID:4},geometry:{type:"Polygon",coordinates:[[[-8.792422238804665,30.508616309773554],[-8.79228996654979,30.50830911402023],
[-8.792232456873757,30.5082397471029],[-8.792140441392107,30.508056420011744],[-8.792100184618885,30.508056420011744],[-8.792048425910455,30.507957324142897],[-8.791605601405008,30.50807623917341],[-8.791513585923358,30.507922640564935],[-8.79135830979807,30.50797714332475],[-8.791139773029148,30.507536165573597],[-8.7910535085151,30.507318153362394],[-8.791605601405008,30.507119960018976],[-8.792077180748471,30.5069713147463],[-8.792422238804665,30.50775417729602],[-8.79273854202284,30.508517214475297],
[-8.792422238804665,30.508616309773554]]]}},{type:"Feature",properties:{id:4,Zone:"EST",ZoneID:3},geometry:{type:"Polygon",coordinates:[[[-8.791371352232757,30.511026788752684],[-8.790540640643078,30.51116971988036],[-8.78923336389905,30.511353348793115],[-8.788454681664563,30.50966394971392],[-8.78848025881825,30.509637017027124],[-8.788494468348077,30.509622326467557],[-8.789250415334841,30.509377483481096],[-8.789321462983976,30.5094264521277],[-8.789372617291349,30.509521940917676],[-8.789707962195251,
30.51024667329236],[-8.789668175511737,30.51027605422064],[-8.789750590784731,30.510444994385942],[-8.789940998484404,30.510388681030133],[-8.789955208014232,30.510410716694988],[-8.790458225370086,30.51024177647012],[-8.790560533984838,30.51045478800971],[-8.790745257872581,30.510410716694988],[-8.790674210223447,30.510227086001912],[-8.791009555127351,30.510126701076413],[-8.79107627123231,30.510315856563377],[-8.791089367248922,30.510355184007253],[-8.791184499209848,30.51059377565649],[-8.791261429512573,
30.510778296537854],[-8.791316480971597,30.510900396869545],[-8.791371352232757,30.511026788752684]]]}},{type:"Feature",properties:{id:5,Zone:"EST",ZoneID:3},geometry:{type:"Polygon",coordinates:[[[-8.788395001639293,30.509455833303843],[-8.787900510001334,30.508388311538905],[-8.788736030355125,30.50809449615234],[-8.789230521993085,30.50916202114301],[-8.788395001639293,30.509455833303843]]]}},{type:"Feature",properties:{id:6,Zone:"EST",ZoneID:3},geometry:{type:"Polygon",coordinates:[[[-8.788521466454748,
30.509550709957818],[-8.788484521677201,30.509565400528214],[-8.788458944523514,30.509518880381],[-8.788507256924923,30.509506638233297],[-8.788521466454748,30.509550709957818]]]}},{type:"Feature",properties:{id:7,Zone:"CENTRE",ZoneID:2},geometry:{type:"Polygon",coordinates:[[[-8.789920062493515,30.510201164762684],[-8.789893958832874,30.510186171884193],[-8.78980404622399,30.510018751250584],[-8.789641623446656,30.509628934926912],[-8.789525607177131,30.50935656233737],[-8.78937188562001,30.509006724864516],
[-8.789174657961818,30.508566927398554],[-8.789192060402245,30.508521948000137],[-8.790262310488615,30.50817460638942],[-8.790230406014496,30.508077150606685],[-8.790372525944663,30.50802717324431],[-8.790398629605306,30.508077150606685],[-8.790482741400712,30.508049663060557],[-8.790433434486165,30.507927218442514],[-8.791094727222458,30.50770481863988],[-8.79124554837284,30.508009681161422],[-8.791297755694128,30.507997186814563],[-8.79141377196365,30.508232080266787],[-8.791451477251249,30.508232080266787],
[-8.791439875624295,30.508199595035933],[-8.791825629720467,30.508077150606685],[-8.791863335008061,30.508097141544447],[-8.791961948837159,30.508059658532787],[-8.792025757785398,30.508054660796798],[-8.792077965106685,30.508182102984055],[-8.792011255751706,30.50820959049274],[-8.792037359412351,30.50827206207449],[-8.792179479342519,30.508232080266787],[-8.792336101306377,30.508599412506687],[-8.79234770293333,30.508639394163342],[-8.792330300492901,30.50872685397996],[-8.79237960740745,30.508834304504123],
[-8.79234770293333,30.50883930220002],[-8.792579735472382,30.509351564668048],[-8.789920062493515,30.510201164762684]]]}},{type:"Feature",properties:{id:8,Zone:"ABORDS VOIRIES",ZoneID:1},geometry:{type:"Polygon",coordinates:[[[-8.791886283117641,30.512569575536066],[-8.792142054654516,30.51307393485573],[-8.790334602460598,30.513759467599808],[-8.79035733770832,30.513803537396555],[-8.790255029093569,30.513837813891328],[-8.790067463299863,30.513876987013397],[-8.790027676616347,30.513857400454334],
[-8.78995378706125,30.513597878174146],[-8.789891265130015,30.513431391818298],[-8.789726434584027,30.512667509589257],[-8.790118617607236,30.51251571176476],[-8.791283799053002,30.512114180892823],[-8.791232644745628,30.512006452815776],[-8.791357688608098,30.51195258873247],[-8.791329269548447,30.51187424092169],[-8.791329269548447,30.51178609955908],[-8.79136905623196,30.511776306069418],[-8.791357688608098,30.511668577617968],[-8.791533886777945,30.511644093862365],[-8.791448629598989,30.511222972300803],
[-8.791545254401807,30.511198488432964],[-8.79167598207621,30.51116421100765],[-8.791886283117641,30.51115441745534],[-8.792119319406796,30.511115243236233],[-8.792204576585753,30.511115243236233],[-8.792369407131739,30.511634300358388],[-8.79247171574649,30.51192810504839],[-8.79248308337035,30.511991762614187],[-8.792574024361238,30.51237860384861],[-8.791886283117641,30.512569575536066]]]}},{type:"Feature",properties:{id:9,Zone:"ABORDS VOIRIES",ZoneID:1},geometry:{type:"Polygon",coordinates:[[[-8.787651843229373,
30.515140311737287],[-8.788413474028069,30.514582100511646],[-8.788930700913749,30.51509624254655],[-8.78894206853761,30.515130518585526],[-8.788896598042164,30.515213760344153],[-8.788629458881429,30.515409623024443],[-8.788515782642818,30.515487967986058],[-8.78822590823436,30.515703416304945],[-8.787651843229373,30.515140311737287]]]}},{type:"Feature",properties:{id:10,Zone:"ABORDS VOIRIES",ZoneID:1},geometry:{type:"Polygon",coordinates:[[[-8.791005292268403,30.50750380211571],[-8.790914351277515,
30.50757235953512],[-8.790695524518188,30.507645813859416],[-8.790547745407993,30.507694783378113],[-8.790510800630445,30.50772661355205],[-8.790124301419167,30.507841691786265],[-8.790021992804416,30.50762867452203],[-8.790081672829688,30.5076017412715],[-8.79009872426548,30.507584601926347],[-8.790485223476757,30.507452384019444],[-8.790934244619272,30.50731771744796],[-8.791005292268403,30.50750380211571]]]}},{type:"Feature",properties:{id:11,Zone:"ABORDS VOIRIES",ZoneID:1},geometry:{type:"Polygon",
coordinates:[[[-8.79317965485709,30.509543811268493],[-8.792989464353674,30.5095884996953],[-8.792957765936439,30.509551259341045],[-8.792816563896023,30.5095884996953],[-8.792790628827374,30.509566155484467],[-8.792660953484138,30.509605878522397],[-8.792675361855608,30.509677876487267],[-8.792565858232429,30.509710151419743],[-8.792577384929606,30.509769735882315],[-8.792493816375075,30.5097995280999],[-8.792525514792311,30.509881456651215],[-8.792701296924255,30.510301029059168],[-8.79282232724461,
30.51055426123398],[-8.792701296924255,30.510589018539832],[-8.79265519013555,30.510462402580128],[-8.7926292550669,30.510462402580128],[-8.792565858232429,30.510301029059168],[-8.792450591260662,30.510025452119557],[-8.79235261433466,30.510052761580855],[-8.792231584014305,30.509831802991997],[-8.791707119292763,30.509993177291733],[-8.791649485806879,30.509866560556112],[-8.791571680600937,30.50989138738001],[-8.791551508880879,30.50992117956033],[-8.791251814754283,30.51001552140443],[-8.79134691000599,
30.510241444922194],[-8.79107627123231,30.510315856563377],[-8.791009555127351,30.510126701076413],[-8.790674210223447,30.510227086001912],[-8.790745257872581,30.510410716694988],[-8.790560533984838,30.51045478800971],[-8.790458225370086,30.51024177647012],[-8.789955208014232,30.510410716694988],[-8.789940998484404,30.510388681030133],[-8.789750590784731,30.510444994385942],[-8.789668175511737,30.51027605422064],[-8.789707962195251,30.51024667329236],[-8.789372617291349,30.509521940917676],[-8.789321462983976,
30.5094264521277],[-8.789250415334841,30.509377483481096],[-8.788494468348077,30.509622326467557],[-8.788454681664547,30.509663949713932],[-8.788395001639293,30.509455833303843],[-8.789230521993085,30.50916202114301],[-8.788736030355125,30.50809449615234],[-8.789096203611239,30.507964319077622],[-8.78925535034534,30.508324243285767],[-8.790198863126058,30.508035324639142],[-8.790124301419167,30.507841691786265],[-8.790510800630445,30.50772661355205],[-8.790547745407993,30.507694783378113],[-8.790695524518188,
30.507645813859416],[-8.790914351277515,30.50757235953512],[-8.791005292268403,30.50750380211571],[-8.79094869876326,30.507355575092284],[-8.7910535085151,30.507318153362394],[-8.791139773029148,30.507536165573597],[-8.79135830979807,30.50797714332475],[-8.791513585923358,30.507922640564935],[-8.791605601405008,30.50807623917341],[-8.792048425910455,30.507957324142897],[-8.792100184618885,30.508056420011744],[-8.792140441392107,30.508056420011744],[-8.792232456873757,30.5082397471029],[-8.79228996654979,
30.50830911402023],[-8.792422238804665,30.508616309773554],[-8.79273854202284,30.508517214475297],[-8.792807918873141,30.50872451980387],[-8.792439064563485,30.508838724482693],[-8.792663835158432,30.509355126573347],[-8.793026926119499,30.509235957103545],[-8.79317965485709,30.509543811268493]],[[-8.789920062493515,30.510201164762684],[-8.792579735472382,30.509351564668048],[-8.79234770293333,30.50883930220002],[-8.79237960740745,30.508834304504123],[-8.792330300492901,30.50872685397996],[-8.79234770293333,
30.508639394163342],[-8.792336101306377,30.508599412506687],[-8.792179479342519,30.508232080266787],[-8.792037359412351,30.50827206207449],[-8.792011255751706,30.50820959049274],[-8.792077965106685,30.508182102984055],[-8.792025757785398,30.508054660796798],[-8.791961948837159,30.508059658532787],[-8.791863335008061,30.508097141544447],[-8.791825629720467,30.508077150606685],[-8.791439875624295,30.508199595035933],[-8.791451477251249,30.508232080266787],[-8.79141377196365,30.508232080266787],[-8.791297755694128,
30.507997186814563],[-8.79124554837284,30.508009681161422],[-8.791094727222458,30.50770481863988],[-8.790433434486165,30.507927218442514],[-8.790482741400712,30.508049663060557],[-8.790398629605306,30.508077150606685],[-8.790372525944663,30.50802717324431],[-8.790230406014496,30.508077150606685],[-8.790262310488615,30.50817460638942],[-8.789192060402245,30.508521948000137],[-8.789174657961818,30.508566927398554],[-8.78937188562001,30.509006724864516],[-8.789525607177131,30.50935656233737],[-8.789641623446656,
30.509628934926912],[-8.78980404622399,30.510018751250584],[-8.789893958832874,30.510186171884193],[-8.789920062493515,30.510201164762684]],[[-8.788521466454748,30.509550709957818],[-8.788507256924923,30.509506638233297],[-8.788458944523514,30.509518880381],[-8.788484521677201,30.509565400528214],[-8.788521466454748,30.509550709957818]]]}}]},{onEachFeature:function(a,b){c(a,b)}});window["map"+b+"init"]=L.map("map"+b).setView([30.5090965,-8.7930388,17],14);var f=window["map"+b+"init"];f.addLayer(d);
f.whenReady(function(){e.addTo(f);a(e,b);setTimeout(function(){f.invalidateSize()},400);f.flyToBounds(e.getBounds());f.setView([30.5106537,-8.7893274],15)})})};