$(function(){window.colors={S1:"#c62828",S2:"#ffd600",S3:"#2e7d32",S4:"#1565c0",S5:"#6a1b9a"};window.pieChartBackupData={};window.chartList=[];$("select").material_select();$(".datepicker").pickadate({selectMonths:!0,selectYears:5,closeOnSelect:!1,container:void 0,today:"Aujourd'hui",clear:"Effacer",close:"Ok",labelMonthNext:"Mois suivant",labelMonthPrev:"Mois pr\u00e9cedant",labelMonthSelect:"Selectionner un mois",labelYearSelect:"Selectionner une ann\u00e9e",monthsFull:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "),
monthsShort:"Janv. F\u00e9vr. Mars Avr. Mai Juin Juil. Ao\u00fbt Sept. Oct. Nov. D\u00e9c.".split(" "),weekdaysFull:"Dimanche Lundi Mardi Mercredi Jeudi Vendredi Samedi".split(" "),weekdaysShort:"Di Lu Ma Me Je Ve Sa".split(" "),weekdaysLetter:"DLMMJVS".split("")});$.each($("#LineCharts canvas"),function(a,b){getData($(b).attr("id").replace("Zone",""),"ZoneChart")});getData("novalue","LineChartData");makePieChart();returnClickHandler();selectChangeHandler();clearClickHandler();searchClickHandler();
$("#SiteID").trigger("change");$("#Search").trigger("click")});
function getData(a,b){$.getJSON("/dashboard/api",{value:a,field:b},function(c){if("ZoneChart"===b)c=makeLineChart($("#Zone"+a),c.result.ZoneName),window.chartList.push([a,c]);else if("LineChartData"===b)$.each(c.result,function(a,b){$.each(window.chartList,function(c,d){if(a===d[0]){var g=d[1][0];$.each(b,function(a,b){var c=[];$.each(b,function(a,b){c.push({t:new Date(a),y:b})});g.data.datasets.push({label:a,data:c,borderWidth:2,borderColor:window.colors[a],backgroundColor:"rgba(0, 0, 0, 0)",
pointBackgroundColor:window.colors[a]})});g.update()}})});else if("PieChartData"===b){var d={labels:[],datasets:[{data:[],backgroundColor:[]}]};window.pieChartDetail={};$.isEmptyObject(c.result)?(window.pieChart.data={labels:["Aucune donn\u00e9e"],datasets:[{data:[1],backgroundColor:["rgba(150, 150, 150, 1)"]}]},window.pieChart.options.tooltips.enabled=!1,$("#PieChart").off("click")):($.each(c.result,function(a,b){d.labels.push(b.Description);d.datasets[0].data.push(b.Total);d.datasets[0].backgroundColor.push(window.colors[a]);
pieChartDetail[b.Description]=b.Detail}),window.pieChartBackupData.labels=d.labels.slice(0,d.labels.length),window.pieChartBackupData.data=d.datasets[0].data.slice(0,d.datasets[0].data.length),window.pieChartBackupData.backgroundColor=d.datasets[0].backgroundColor.slice(0,d.datasets[0].backgroundColor.length),window.pieChart.data=d,window.pieChart.options.tooltips.enabled=!0,disableHandler(),enableHandler());window.pieChart.options.title.display=!1;window.pieChart.update();$("#Search").removeClass("disabled")}else{removeOptions(b);
for(var e=0,f=c.result.length;e<f;e++){var h=c.result[e][b+"Name"];if("Category"===b||"LocationType"===b)h=c.result[e].Description;$("#"+b+"ID").append($("<option></option>").attr("value",c.result[e][b+"ID"]).text(h))}$("select").material_select()}})}
function makeLineChart(a,b){var c=[],d=a[0].getContext("2d");d=new Chart(d,{type:"line",data:{labels:[],datasets:[]},options:{title:{display:!1,position:"top",text:b},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Nombre d'anomalies"},ticks:{beginAtZero:!0,stepSize:1},drawBorder:!0}],xAxes:[{type:"time",position:"bottom",time:{displayFormats:{day:"DD/MM"},minUnit:"day"},ticks:{source:"data"},distribution:"series"}]},legend:{display:!0,position:"top"},elements:{line:{tension:0}},maintainAspectRatio:!1,
responsiveAnimationDuration:0,hover:{mode:"nearest"}}});c.push(d);return c}function makePieChart(){var a=$("#PieChart")[0].getContext("2d");a=new Chart(a,{type:"pie",data:{labels:[],datasets:[{data:[],backgroundColor:[]}]},options:{title:{display:!1,position:"top",text:""},legend:{position:"top"},animation:{animateRotate:!1},maintainAspectRatio:!1}});window.pieChart=a}
function PieClickHandler(a){if(a=window.pieChart.getElementAtEvent(a)[0]){a=window.pieChart.data.labels[a._index];var b=[],c=[];$.each(pieChartDetail[a],function(a,e){b.push(a);c.push(e)});window.pieChart.data.labels=b.slice(0,b.length);window.pieChart.data.datasets[0].data=c.slice(0,c.length);window.pieChart.options.title.display=!0;window.pieChart.options.title.text=a;window.pieChart.update();disableHandler();$("#Return").removeClass("hide").addClass("show")}}
function enableHandler(){$("#PieChart").on("click",function(a){PieClickHandler(a)})}function disableHandler(){$("#PieChart").off("click")}function removeOptions(a){$("#"+a+"ID")[0].selectedIndex=0;$("#"+a+"ID").children("option:not(:first)").remove()}
function returnClickHandler(){$("#Return").on("click",function(){$(this).removeClass("show").addClass("hide");window.pieChart.data.datasets[0].data=window.pieChartBackupData.data;window.pieChart.data.datasets[0].backgroundColor=window.pieChartBackupData.backgroundColor;window.pieChart.data.labels=window.pieChartBackupData.labels;window.pieChart.options.title.display=!1;window.pieChart.update();disableHandler();enableHandler()})}
function searchClickHandler(){$("#Search").on("click",function(){var a={dateFrom:$("#dateFrom").val(),dateTo:$("#dateTo").val(),SiteID:$("#SiteID").val(),ZoneID:$("#ZoneID").val(),UnitID:$("#UnitID").val(),LocationTypeID:$("#LocationTypeID").val(),LocationID:$("#LocationID").val()};$(this).addClass("disabled");window.pieDataQuery=JSON.stringify(a);getData(window.pieDataQuery,"PieChartData")})}
function clearClickHandler(){$("#Clear").on("click",function(){var a=[$("#dateFrom"),$("#dateTo"),$("#SiteID")];$.each(a,function(a,c){c.val("")});$.each(["Zone","Unit","LocationType","Location"],function(a,c){removeOptions(c)});$("select").material_select()})}
function selectChangeHandler(){var a=["Zone","Unit","LocationType","Location"],b=a.slice(1,a.length),c=a.slice(2,a.length),d=a.slice(3,a.length);a=[[$("#SiteID"),a],[$("#ZoneID"),b],[$("#UnitID"),c],[$("#LocationTypeID"),d]];b={};c=0;for(d=a.length;c<d;b={inputArray:b.inputArray},c++){var e=a[c][0],f=a[c][1];b.inputArray=f.slice(0,f.length);e.on("change",function(a){return function(){for(var b=0,c=a.inputArray.length;b<c;b++)removeOptions(a.inputArray[b]);b=$(this).val();"Location"==a.inputArray[0]&&
(b=$("#UnitID"),b={LocationTypeID:$(this).val(),UnitID:b.val()},b=JSON.stringify(b));getData(b,a.inputArray[0])}}(b))}}
function makeParetoChart(a){var b="";$.each(a,function(a,d){b=d.getContext("2d")});new Chart(b,{type:"bar",data:{labels:["S1","S2","S3","S4","S5"],datasets:[{label:"Bar Dataset",data:[66,50,40,24,20],borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.2)",yAxisID:"original"},{label:"Line Dataset",data:[33,58,78,90,100],type:"line",fill:!1,borderColor:"rgb(54, 162, 235)",yAxisID:"test"}]},options:{scales:{yAxes:[{id:"original",type:"linear",ticks:{beginAtZero:!0}},{id:"test",type:"linear",
ticks:{beginAtZero:!0},position:"right"}]}}})};